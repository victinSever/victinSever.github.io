{
    "version": "https://jsonfeed.org/version/1",
    "title": "眸光似星辰 • All posts by \"mongodb\" category",
    "description": "",
    "home_page_url": "http://victinSever.github.io",
    "items": [
        {
            "id": "http://victinsever.github.io/2023/01/08/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/mongodb/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "url": "http://victinsever.github.io/2023/01/08/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/mongodb/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "title": "mongodb学习笔记",
            "date_published": "2023-01-08T13:04:01.000Z",
            "content_html": "<h2 id=\"mongodb\"><a href=\"#mongodb\" class=\"headerlink\" title=\"mongodb\"></a>mongodb</h2><h3 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h3><p>数据库，集合，数据&#x2F;文档</p>\n<h3 id=\"进入数据库\"><a href=\"#进入数据库\" class=\"headerlink\" title=\"进入数据库\"></a>进入数据库</h3><ul>\n<li>配置环境变量直到可以输入mongo或者mongosh进入数据库命令行操作模式</li>\n</ul>\n<h3 id=\"基本命令\"><a href=\"#基本命令\" class=\"headerlink\" title=\"基本命令\"></a>基本命令</h3><ul>\n<li>show databases 展示数据库</li>\n<li>use admin 选择一个数据库<ul>\n<li>可选择现成的数据库，也可以选择不存在的，选择不存在则隐式创建数据库</li>\n</ul>\n</li>\n<li>show collections 展示集合</li>\n<li>db.createCollection(“c1”) 创建集合</li>\n<li>db.c1.drop() 删除集合</li>\n</ul>\n<h3 id=\"增删查改\"><a href=\"#增删查改\" class=\"headerlink\" title=\"增删查改\"></a>增删查改</h3><h4 id=\"增加\"><a href=\"#增加\" class=\"headerlink\" title=\"增加\"></a>增加</h4><ul>\n<li><p>语法：db.集合名.insert(json数据)</p>\n</li>\n<li><p>&#96;&#96;&#96;js 1<br>db.getCollection(‘user’).insert({“userId” : “014”,”uclass” : “B”,”name” : “Back”,”age” : 11,”email” : “<span class=\"exturl\" data-url=\"bWFpbHRvOiYjeDYyOyYjeDMxOyYjNTI7JiN4NDA7JiMxMTU7JiMxMDU7JiN4NmU7JiN4NjE7JiM0NjsmI3g2MzsmIzExMTsmIzEwOTs=\">&#x62;&#x31;&#52;&#x40;&#115;&#105;&#x6e;&#x61;&#46;&#x63;&#111;&#109;</span>“,”birthday” : ISODate(“2018-07-31T03:46:13.885Z”),”dataStatus” : 1});</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- 注意</span><br><span class=\"line\"></span><br><span class=\"line\">  - 自定义_id，只需要插入的json数据存在_id这个数据进行覆盖</span><br><span class=\"line\"></span><br><span class=\"line\">  - 一次插入多个数据</span><br><span class=\"line\"></span><br><span class=\"line\">    ```js 1</span><br><span class=\"line\">    db.c1.insert([</span><br><span class=\"line\">    \t&#123;name:&#x27;张三&#x27;,age:14&#125;,</span><br><span class=\"line\">    \t&#123;name:&#x27;李四&#x27;,age:14&#125;,</span><br><span class=\"line\">    ])</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>插入循环数据</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">\tdb.<span class=\"property\">c2</span>.<span class=\"title function_\">insert</span>(&#123;<span class=\"attr\">name</span>:<span class=\"string\">&#x27;a&#x27;</span>+i,<span class=\"attr\">age</span>:i&#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../../../image/image-20230103230437314.png\" alt=\"image-20230103230437314\"></p>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"查询\"><a href=\"#查询\" class=\"headerlink\" title=\"查询\"></a>查询</h4><ul>\n<li><p>语法：</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.集合名.<span class=\"title function_\">find</span>(条件，[,查询的列])</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>查询全部</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">find</span>()</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查询一列</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">find</span>(&#123;&#125;,&#123;<span class=\"attr\">name</span>:<span class=\"number\">1</span>&#125;)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查询除了某一列</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">find</span>(&#123;&#125;,&#123;<span class=\"attr\">name</span>:<span class=\"number\">0</span>&#125;)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>语法升级：</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.集合名.<span class=\"title function_\">find</span>(&#123;</span><br><span class=\"line\">\t<span class=\"attr\">age</span>: &#123;运算符:值&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>年龄大于5</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">find</span>(&#123;<span class=\"attr\">age</span>:&#123;<span class=\"attr\">$gt</span>:<span class=\"number\">5</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>年龄为5,8,10</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">find</span>(&#123;<span class=\"attr\">age</span>:&#123;<span class=\"attr\">$in</span>:[<span class=\"number\">5</span>,<span class=\"number\">8</span>,<span class=\"number\">10</span>]&#125;&#125;)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>运算符</p>\n<p><img data-src=\"/../../../image/image-20230103231503013.png\" alt=\"image-20230103231503013\"></p>\n</li>\n</ul>\n<h4 id=\"修改\"><a href=\"#修改\" class=\"headerlink\" title=\"修改\"></a>修改</h4><ul>\n<li><p>语法：</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.集合名.<span class=\"title function_\">update</span>(条件,新数据 [，是否新增，是否修改多条])</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>升级语法：</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.集合名.<span class=\"title function_\">update</span>(<span class=\"params\">条件,新数据</span>)</span><br><span class=\"line\">\t\t\t\t\t&#123;修改器：&#123;键：值&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../../../image/image-20230103232023122.png\" alt=\"image-20230103232023122\"></p>\n</li>\n<li><p>因为不用修改器，默认是替换而不是修改，所以在修改数据需要使用修改器</p>\n</li>\n<li><p>测试</p>\n<ul>\n<li><p>修改一个信息</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c3</span>.<span class=\"title function_\">update</span>(&#123;<span class=\"attr\">name</span>:<span class=\"string\">&#x27;a1&#x27;</span>&#125;,&#123;<span class=\"attr\">$set</span>:&#123;<span class=\"attr\">name</span>:<span class=\"string\">&#x27;s1&#x27;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改多个信息</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c4</span>.<span class=\"title function_\">update</span>(&#123;<span class=\"attr\">name</span>:<span class=\"string\">&quot;哈哈&quot;</span>&#125;,&#123;</span><br><span class=\"line\">\t<span class=\"attr\">$set</span>:&#123;<span class=\"attr\">name</span>:<span class=\"string\">&quot;haha&quot;</span>&#125;，</span><br><span class=\"line\">\t$inc：&#123;age：<span class=\"number\">111</span>&#125;，</span><br><span class=\"line\">\t<span class=\"attr\">$rename</span>:&#123;<span class=\"attr\">who</span>:<span class=\"string\">&quot;sex&quot;</span>&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">$unset</span>:&#123;<span class=\"attr\">other</span>:<span class=\"literal\">true</span>&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h4><ul>\n<li><p>语法：</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.集合名.<span class=\"title function_\">remove</span>(条件,[,是否删除一条])</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"查询语句扩展\"><a href=\"#查询语句扩展\" class=\"headerlink\" title=\"查询语句扩展\"></a>查询语句扩展</h3><ul>\n<li><p>格式化</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">find</span>().<span class=\"title function_\">pretty</span>()</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>排序</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">find</span>().<span class=\"title function_\">sort</span>(json)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//sort(&#123;列:1/-1&#125;)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">find</span>().<span class=\"title function_\">sort</span>(&#123;<span class=\"attr\">age</span>:-<span class=\"number\">1</span>&#125;) <span class=\"comment\">//以年龄降序</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>limit和skip方法</p>\n<figure class=\"highlight js\"><figcaption><span>1</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.集合名.<span class=\"title function_\">find</span>().<span class=\"title function_\">sort</span>().<span class=\"title function_\">skip</span>(数字).<span class=\"title function_\">limit</span>(数字)</span><br><span class=\"line\"><span class=\"comment\">//skip跳过指定数量(可选)</span></span><br><span class=\"line\"><span class=\"comment\">//limit限制查询的数量(可选)</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>分页展示</p>\n<figure class=\"highlight js\"><figcaption><span>11</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.集合名.<span class=\"title function_\">find</span>().<span class=\"title function_\">skip</span>().<span class=\"title function_\">limit</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"comment\">//skip计算公式：（当前页 - 1） * 每页显示条数</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>count方法：统计数量</p>\n</li>\n</ul>\n<h3 id=\"聚合查询\"><a href=\"#聚合查询\" class=\"headerlink\" title=\"聚合查询\"></a>聚合查询</h3><ul>\n<li><p>语法：</p>\n<figure class=\"highlight js\"><figcaption><span>11</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.集合名.<span class=\"title function_\">aggregate</span>([</span><br><span class=\"line\">    &#123;管道：&#123;表达式&#125;&#125;</span><br><span class=\"line\">    ···</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../../../image/image-20230103235138600.png\" alt=\"image-20230103235138600\"><img data-src=\"/../../../image/image-20230103235145652.png\" alt=\"image-20230103235145652\"></p>\n</li>\n<li><p>练习</p>\n<ul>\n<li><p>统计男生女生总年龄</p>\n<figure class=\"highlight js\"><figcaption><span>11</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">aggregate</span>([</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">$group</span>:&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">_id</span>:<span class=\"string\">&quot;$sex&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">rs</span>:&#123;<span class=\"attr\">$sum</span>:<span class=\"string\">&quot;$age&quot;</span>&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>统计男女生人数</p>\n<figure class=\"highlight js\"><figcaption><span>11</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">aggregate</span>([</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">$group</span>:&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">_id</span>:<span class=\"string\">&quot;$sex&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">rs</span>:&#123;<span class=\"attr\">$sum</span>:<span class=\"number\">1</span>&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>人总数和，平局年龄</p>\n<figure class=\"highlight js\"><figcaption><span>11</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">aggregate</span>([</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">$group</span>:&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">_id</span>:<span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">total_num</span>:&#123;<span class=\"attr\">$sum</span>:<span class=\"number\">1</span>&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">total_avg</span>:&#123;<span class=\"attr\">$avg</span>:<span class=\"string\">&quot;$age&quot;</span>&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>人数升序查询男女生人数</p>\n<figure class=\"highlight js\"><figcaption><span>mongodb</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">c1</span>.<span class=\"title function_\">aggregate</span>([</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">$group</span>:&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">_id</span>:<span class=\"string\">&quot;$sex&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">rs</span>:&#123;<span class=\"attr\">$sum</span>:<span class=\"number\">1</span>&#125;,</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">$sort</span>:&#123;<span class=\"attr\">rs</span>:<span class=\"number\">1</span>&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"索引操作\"><a href=\"#索引操作\" class=\"headerlink\" title=\"索引操作\"></a>索引操作</h3><ul>\n<li><p>优点：提高数据库查询效率，降低数据库IO，降低数据排序成本，降低CPU消耗</p>\n</li>\n<li><p>缺点：占用磁盘空间，增加了索引数据，空间插入和修改需要更新索引</p>\n</li>\n<li><p>语法</p>\n<ul>\n<li>创建：db.集合名.createIndex(待创建索引的列,[,额外选项])<ul>\n<li>1升序， -1降序</li>\n</ul>\n</li>\n<li>删除全部：db.集合名.dropIndexes()</li>\n<li>删除指定：db.集合名.dropIndex(索引名)</li>\n<li>查看索引：db.集合名.getIndexes()</li>\n<li>分析索引：db.集合名.explain(“executionStatus”)</li>\n</ul>\n</li>\n<li><p>练习</p>\n<ul>\n<li><p>创建唯一索引</p>\n<figure class=\"highlight js\"><figcaption><span>mongodb</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.集合名.<span class=\"title function_\">createIndex</span>(待添加索引列, &#123;<span class=\"attr\">unique</span>: 列名&#125;)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>选择规则</p>\n<ul>\n<li>为常用条件、排序、分组的字段简历索引</li>\n<li>选择唯一性索引</li>\n<li>选择较小的数据列，为长字符串使用前缀索引</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"权限机制\"><a href=\"#权限机制\" class=\"headerlink\" title=\"权限机制\"></a>权限机制</h3><p>使用权限机制开启账号机制</p>\n<ul>\n<li><p>开启验证模式</p>\n<ul>\n<li><p>添加超级管理员</p>\n<ul>\n<li><p>&#96;&#96;&#96;js mongodb<br>use admin</p>\n<p>db.createUser({<br>“user”: “admin”,<br>“pwd”: “123456”,<br>“roles”: [{<br>    role: “root”,<br>    db: “admin”<br>}]<br>})</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- 退出卸载服务</span><br><span class=\"line\"></span><br><span class=\"line\">  - ```</span><br><span class=\"line\">    在mogodb的bin目录下</span><br><span class=\"line\">    mongod --remove</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>重新安装需要输入账密的服务</p>\n<ul>\n<li>&#96;&#96;&#96;js mongodb<br>在mogodb的bin目录下<br>mongod –install –dbpath E:\\Application\\mongodb\\data –logpath E:\\Application\\mongodb\\logs\\mongodb2.log –auth<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- 启动服务</span><br><span class=\"line\"></span><br><span class=\"line\">  - ```js mongodb</span><br><span class=\"line\">    net start mongodb</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>登录测试</p>\n<ul>\n<li><p>&#96;&#96;&#96;js mongodb<br>mongo或者mongosh</p>\n<p>use admin</p>\n<p>db.auth(‘admin’, ‘123456’)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- ```js mongodb</span><br><span class=\"line\">  mongosh 127.0.0.1:27017/admin -u admin -p 123456</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>添加用户权限</p>\n<ul>\n<li><p>&#96;&#96;&#96;js mongodb<br>&#x2F;&#x2F;在管理员权限下，进入新的数据库</p>\n<p>use shop</p>\n<p>&#x2F;&#x2F;shop1 只读权限<br>db.createUser({<br>“user”: “shop1”,<br>“pwd”: “123456”,<br>“roles”: [{<br>    role: “read”,<br>    db: “shop”<br>}]<br>})<br>&#x2F;&#x2F;shop2 可读可写权限<br>db.createUser({<br>“user”: “shop2”,<br>“pwd”: “123456”,<br>“roles”: [{<br>    role: “readWrite”,<br>    db: “shop”<br>}]<br>})</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### 备份和还原数据库</span><br><span class=\"line\"></span><br><span class=\"line\">- 备份</span><br><span class=\"line\"></span><br><span class=\"line\">  - 语法：</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; 导出数据库语法：mongodbump -h -port -u -p -d -o</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; 说明：</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-h   \t\thost服务器IP地址</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-port\t\t\t 端口</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-u \t\t user账号</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-p \t\t pwd 密码</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-d\t\t  database 数据库</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-o \t\t open 备份到指定目录下</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">  - 练习</span><br><span class=\"line\"></span><br><span class=\"line\">    - 备份所有数据：</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt;mongodbump  -u admin -p 123456 -o E:\\Application\\mongodb\\bak</span><br><span class=\"line\"></span><br><span class=\"line\">    - 备份指定数据：</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt; mongodbump  -u shop -p 123456 -d shop -o E:\\Application\\mongodb\\bak2</span><br><span class=\"line\"></span><br><span class=\"line\">- 还原</span><br><span class=\"line\"></span><br><span class=\"line\">  - 语法：</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; 导出数据库语法：mongorestore -h -port -u -p -d -drop</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; 说明：</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-h   \t\thost服务器IP地址</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-port\t\t\t 端口</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-u \t\t user账号</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-p \t\t pwd 密码</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-d\t\t  database 数据库</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">    &gt; ​\t-drop \tdrop</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">  - 练习</span><br><span class=\"line\"></span><br><span class=\"line\">    - 还原所有数据库：</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt;mongorestore -u admin -p 123456 -drop E:\\Application\\mongodb\\bak</span><br><span class=\"line\"></span><br><span class=\"line\">    - 还原指定数据库：（删除时不能删除admin数据库）</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt; mongorestore -u shop -p 123456 -d shop -drop E:\\Application\\mongodb\\bak2</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">## mongoose</span><br><span class=\"line\"></span><br><span class=\"line\">- 使用node语言管理mongodb</span><br><span class=\"line\"></span><br><span class=\"line\">- 是node中的一个模块包</span><br><span class=\"line\"></span><br><span class=\"line\">- 核心概念</span><br><span class=\"line\">  - schema</span><br><span class=\"line\">    - 约束字段</span><br><span class=\"line\">  - model</span><br><span class=\"line\">    - 模型</span><br><span class=\"line\">    - 对应集合，用户数据增删改查</span><br><span class=\"line\"></span><br><span class=\"line\">- 使用</span><br><span class=\"line\"></span><br><span class=\"line\">  - 下载</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p>npm i mongoose 或 yarn add mongoose</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- 语法</span><br><span class=\"line\"></span><br><span class=\"line\">  ```js mongodb-connection.js</span><br><span class=\"line\">  //导入数据库</span><br><span class=\"line\">  var mongoose = require(&#x27;mongoose&#x27;);</span><br><span class=\"line\">  </span><br><span class=\"line\">  //链接数据库</span><br><span class=\"line\">  const db = mongoose.createConnection(&#x27;mongodb://admin:123456@localhost:27017/weblog?authMechanism=DEFAULT&amp;authSource=admin&#x27;, &#123;</span><br><span class=\"line\">      useNewUrlParser: true,</span><br><span class=\"line\">      useUnifiedTopology: true</span><br><span class=\"line\">  &#125;, err =&gt; &#123;</span><br><span class=\"line\">      if(err) console.error(&quot;连接出错：&quot; + err)</span><br><span class=\"line\">      else console.log(&quot;weblog数据库连接成功！&quot;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  //创建模型</span><br><span class=\"line\">  const Users = db.model(&#x27;users&#x27;, &#123;</span><br><span class=\"line\">      name: String,</span><br><span class=\"line\">      age: Number</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  //实例操作</span><br><span class=\"line\">  </span><br><span class=\"line\">  //增</span><br><span class=\"line\">  //增加一条数据</span><br><span class=\"line\">  async function insertOne(obj) &#123;</span><br><span class=\"line\">      const res = await new Users(obj).save()</span><br><span class=\"line\">      console.log(res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  // insertOne(&#123; name: &#x27;神龙&#x27;,age: 100000 &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  //查</span><br><span class=\"line\">  //查一条</span><br><span class=\"line\">  async function search(obj) &#123;</span><br><span class=\"line\">      const res = await Users.find(obj)</span><br><span class=\"line\">      console.log(res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  //查全部</span><br><span class=\"line\">  async function searchAll() &#123;</span><br><span class=\"line\">      const res = await Users.find(&#123;&#125;)</span><br><span class=\"line\">      console.log(res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  //分页查询</span><br><span class=\"line\">  async function searchPagination(page = 1, size = 2) &#123;</span><br><span class=\"line\">      const res = await Users.find(&#123;&#125;).skip((page - 1) * size).limit(size)</span><br><span class=\"line\">      console.log(res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  // search(&#123; name: &#x27;神龙&#x27;&#125;)</span><br><span class=\"line\">  // searchAll()</span><br><span class=\"line\">  searchPagination(2)</span><br><span class=\"line\">  </span><br><span class=\"line\">  // db.close()</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"接口\"><a href=\"#接口\" class=\"headerlink\" title=\"接口\"></a>接口</h2><ul>\n<li><p>作用</p>\n<ul>\n<li>数据角度：让项目静态&#x2F;固定数据动态</li>\n<li>功能角度：天气接口，获取IP接口，名言接口</li>\n</ul>\n</li>\n<li><p>接口地址</p>\n<ul>\n<li>通过编程语言实现：node&#x2F;go&#x2F;java&#x2F;php&#x2F;asp</li>\n<li>使用第三方接口</li>\n</ul>\n</li>\n<li><p>一次编写，多次接入</p>\n</li>\n<li><p>一个返回json或者xml数据的文件</p>\n</li>\n</ul>\n<h3 id=\"接口开发规范\"><a href=\"#接口开发规范\" class=\"headerlink\" title=\"接口开发规范\"></a>接口开发规范</h3><ul>\n<li><p>保证多人开发编写的规范性，可以方便后期维护，使用Restful API思想</p>\n</li>\n<li><p>Restful</p>\n<ul>\n<li>目前流行的互联网软件架构</li>\n<li>申明一个设计原则和规范</li>\n<li>规范条件<ul>\n<li>项目统一有模块标准</li>\n<li>根据URL知道操作资源</li>\n<li>根据H团体票Method知道操作动作</li>\n<li>根据Http Status Code知道操作结果</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>接口测试工具</p>\n</li>\n</ul>\n<h3 id=\"接口测试工具\"><a href=\"#接口测试工具\" class=\"headerlink\" title=\"接口测试工具\"></a>接口测试工具</h3><ul>\n<li>Postman，apifox···</li>\n<li>测试接口<ul>\n<li>测试地址：<span class=\"exturl\" data-url=\"aHR0cDovL2pzb252aWV3LmNvbS9leGFtcGxlLmpzb24=\">http://jsonview.com/example.json</span></li>\n</ul>\n</li>\n<li>使用<ul>\n<li>后端：调试接口</li>\n<li>前端：测试接口</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"接口开发\"><a href=\"#接口开发\" class=\"headerlink\" title=\"接口开发\"></a>接口开发</h2><ul>\n<li><p>下载模块依赖</p>\n<ul>\n<li><p>express</p>\n<blockquote>\n<p>框架</p>\n</blockquote>\n</li>\n<li><p>body-parser</p>\n<blockquote>\n<p>request解析</p>\n</blockquote>\n</li>\n<li><p>mongoose</p>\n<blockquote>\n<p>node操作mongodb</p>\n</blockquote>\n</li>\n<li><pre><code class=\"json\">&#123;\n  &quot;dependencies&quot;: &#123;\n    &quot;body-parser&quot;: &quot;^1.20.1&quot;,\n    &quot;express&quot;: &quot;^4.18.2&quot;,\n    &quot;mongoose&quot;: &quot;^6.8.3&quot;\n  &#125;\n&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- 开发实战</span><br><span class=\"line\"></span><br><span class=\"line\">  - 目录</span><br><span class=\"line\"></span><br><span class=\"line\">    ![image-20230109234239665](../../../image/image-20230109234239665.png)</span><br><span class=\"line\"></span><br><span class=\"line\">  - 根文件http.js</span><br><span class=\"line\"></span><br><span class=\"line\">    ```js http.js</span><br><span class=\"line\">    //引入express</span><br><span class=\"line\">    const express = require(&#x27;express&#x27;)</span><br><span class=\"line\">    </span><br><span class=\"line\">    //创建app</span><br><span class=\"line\">    const app = express()</span><br><span class=\"line\">    </span><br><span class=\"line\">    //引入body-parser模块</span><br><span class=\"line\">    const bodyparser = require(&#x27;body-parser&#x27;)</span><br><span class=\"line\">    app.use(bodyparser.urlencoded(&#123;extend: true&#125;))</span><br><span class=\"line\">    app.use(bodyparser.json())</span><br><span class=\"line\">    </span><br><span class=\"line\">    //路由语法</span><br><span class=\"line\">    app.get(&#x27;/&#x27;, (request, response) =&gt; &#123;</span><br><span class=\"line\">        response.send(&#x27;访问成功！&#x27;)    </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    </span><br><span class=\"line\">    const userController = require(process.cwd() + &#x27;/controller/user&#x27;)</span><br><span class=\"line\">    </span><br><span class=\"line\">    app.post(&#x27;/user/addUser&#x27;, userController.addUser)</span><br><span class=\"line\">    app.get(&#x27;/user/getAllUser&#x27;, userController.getAllUser)</span><br><span class=\"line\">    app.get(&#x27;/user/getUserList&#x27;, userController.getUserList)</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    app.listen(8000, () =&gt; &#123;</span><br><span class=\"line\">        console.log(&quot;http://localhost:8000接口服务正在运行中···&quot;);</span><br><span class=\"line\">    &#125;)</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n<li><p>控制器controller</p>\n<figure class=\"highlight js\"><figcaption><span>controller/user.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//导入模型</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    createUserModel, listUserModel, listUserModelByPagination</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(process.<span class=\"title function_\">cwd</span>() + <span class=\"string\">&#x27;/models/user&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//定义处理方法</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//添加一条数据</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">addUser</span> = <span class=\"keyword\">async</span> (<span class=\"params\">req, res</span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> rs = <span class=\"keyword\">await</span> <span class=\"title function_\">createUserModel</span>(req.<span class=\"property\">body</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//判断返回值</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rs) &#123;</span><br><span class=\"line\">            res.<span class=\"title function_\">send</span>(&#123;</span><br><span class=\"line\">                <span class=\"attr\">meta</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">state</span>: <span class=\"number\">200</span>,</span><br><span class=\"line\">                    <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;添加成功！&#x27;</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"attr\">data</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            res.<span class=\"title function_\">send</span>(&#123;</span><br><span class=\"line\">                <span class=\"attr\">meta</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">state</span>: <span class=\"number\">500</span>,</span><br><span class=\"line\">                    <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;添加失败！&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (err) &#123; <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(err) &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//获取所有用户</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getAllUser</span> = <span class=\"keyword\">async</span> (<span class=\"params\">req, res</span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> data = <span class=\"keyword\">await</span> <span class=\"title function_\">listUserModel</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//判断返回值</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data) &#123;</span><br><span class=\"line\">        res.<span class=\"title function_\">send</span>(&#123;</span><br><span class=\"line\">            <span class=\"attr\">meta</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">state</span>: <span class=\"number\">200</span>,</span><br><span class=\"line\">                <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;查询成功！&#x27;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"attr\">data</span>: data</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//获取所有用户</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getUserList</span> = <span class=\"keyword\">async</span> (<span class=\"params\">req, res</span>) =&gt; &#123; </span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; query &#125; = req</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(query);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = <span class=\"built_in\">parseInt</span>(query.<span class=\"property\">page</span>), size = <span class=\"built_in\">parseInt</span>(query.<span class=\"property\">size</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(page, size);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> data = <span class=\"keyword\">await</span> <span class=\"title function_\">listUserModel</span>(page, size)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//判断返回值</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data) &#123;</span><br><span class=\"line\">        res.<span class=\"title function_\">send</span>(&#123;</span><br><span class=\"line\">            <span class=\"attr\">meta</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">state</span>: <span class=\"number\">200</span>,</span><br><span class=\"line\">                <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;查询成功！&#x27;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"attr\">data</span>: data</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    addUser, getAllUser, getUserList</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>模型model</p>\n<figure class=\"highlight js\"><figcaption><span>model/user.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//导入数据库</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//链接数据库</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> db = mongoose.<span class=\"title function_\">createConnection</span>(<span class=\"string\">&#x27;mongodb://admin:123456@localhost:27017/weblog?authMechanism=DEFAULT&amp;authSource=admin&#x27;</span>, &#123;</span><br><span class=\"line\">    <span class=\"attr\">useNewUrlParser</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">useUnifiedTopology</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(err) <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&quot;连接出错：&quot;</span> + err)</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;weblog数据库连接成功！&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//创建模型</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Users</span> = db.<span class=\"title function_\">model</span>(<span class=\"string\">&#x27;users&#x27;</span>, &#123;</span><br><span class=\"line\">    <span class=\"attr\">username</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">default</span>: <span class=\"string\">&#x27;未命名用户&#x27;</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">default</span>: <span class=\"string\">&#x27;&#x27;</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">phone</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">default</span>: <span class=\"string\">&#x27;&#x27;</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">role</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">default</span>: <span class=\"string\">&#x27;user&#x27;</span> &#125;,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//实例操作</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//创建模型</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">createUserModel</span> = (<span class=\"params\">obj</span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Users</span>(obj).<span class=\"title function_\">save</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//分页查询模型列表</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">listUserModel</span> = (<span class=\"params\">page = <span class=\"number\">1</span>, size = <span class=\"number\">10</span></span>) =&gt; &#123;   </span><br><span class=\"line\"> <span class=\"keyword\">return</span> <span class=\"title class_\">Users</span>.<span class=\"title function_\">find</span>(&#123;&#125;).<span class=\"title function_\">skip</span>((page - <span class=\"number\">1</span>) * size).<span class=\"title function_\">limit</span>(size)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    createUserModel,</span><br><span class=\"line\">    listUserModel</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// db.close()</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"接口文档\"><a href=\"#接口文档\" class=\"headerlink\" title=\"接口文档\"></a>接口文档</h3><ul>\n<li><p>工具：apidoc</p>\n</li>\n<li><p>apidoc</p>\n<ul>\n<li>根据注释生产接口文档</li>\n</ul>\n</li>\n<li><p>使用</p>\n<ul>\n<li><p>下载（1次）</p>\n<blockquote>\n<p>npm i apidoc -g</p>\n</blockquote>\n</li>\n<li><p>根目录下创建apidoc.json文件（1次）</p>\n<blockquote>\n<p>{</p>\n<p>​\t“name”: “weblog”,</p>\n<p>​\t“version”: “1.0.0”,</p>\n<p>​\t“description”:  “该项目为博客系统，基于mongodb+node+express搭建的后台平台”，</p>\n<p>​\t“title”: “暂无”,</p>\n<p>​\t“url”: “”</p>\n<p>}</p>\n</blockquote>\n</li>\n<li><p>写接口注释（N次）</p>\n<blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @api &#123;get&#125; /user/getUserList 分页获取用户</span><br><span class=\"line\"> * @apiName 分页获取用户</span><br><span class=\"line\"> * @apiGroup User</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * @apiParam &#123;Number&#125; page  当前页</span><br><span class=\"line\"> * @apiParam &#123;Number&#125; size  每页显示条数</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * @apiSuccess &#123;String&#125; meta 状态码&amp;提示信息</span><br><span class=\"line\"> * @apiSuccess &#123;String&#125; data 数据</span><br><span class=\"line\"> */</span><br></pre></td></tr></table></figure>\n</blockquote>\n</li>\n<li><p>创建接口文档</p>\n<blockquote>\n<p>apidoc -i .&#x2F;接口注释目录 -o .&#x2F;接口文档存放目录</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n",
            "tags": []
        }
    ]
}