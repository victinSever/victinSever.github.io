{
    "version": "https://jsonfeed.org/version/1",
    "title": "眸光似星辰 • All posts by \"websocket\" tag",
    "description": "",
    "home_page_url": "http://victinSever.github.io",
    "items": [
        {
            "id": "http://victinsever.github.io/2022/11/14/%E6%89%A9%E5%B1%95%E6%8A%80%E6%9C%AF/WebSocket/WebSocket%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/",
            "url": "http://victinsever.github.io/2022/11/14/%E6%89%A9%E5%B1%95%E6%8A%80%E6%9C%AF/WebSocket/WebSocket%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/",
            "title": "WebSocket客户端和服务端的简单实现",
            "date_published": "2022-11-14T01:43:06.000Z",
            "content_html": "<h1 id=\"WebSocket客户端和服务端的简单实现\"><a href=\"#WebSocket客户端和服务端的简单实现\" class=\"headerlink\" title=\"WebSocket客户端和服务端的简单实现\"></a>WebSocket客户端和服务端的简单实现</h1><h2 id=\"WebSocket-客户端页面实现\"><a href=\"#WebSocket-客户端页面实现\" class=\"headerlink\" title=\"WebSocket 客户端页面实现\"></a>WebSocket 客户端页面实现</h2><p>本地访问服务端地址为：ws:&#x2F;&#x2F;localhost:8080&#x2F;WebSocket_war_exploded&#x2F;websocket</p>\n<figure class=\"highlight html\"><figcaption><span>WebSocket 客户端页面实现</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">HTML</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>WebSocket测试<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;text-align: center;&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>WebSocket测试<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;txt&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;sendWebSocket()&quot;</span>&gt;</span>发送<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;checkWebSocket()&quot;</span>&gt;</span>测试WebSocket<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;connectWebSocket()&quot;</span>&gt;</span>连接WebSocket<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;closeWebSocket()&quot;</span>&gt;</span>关闭WebSocket<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">hr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;message&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">var</span> websocket = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">function</span> <span class=\"title function_\">checkWebSocket</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">if</span> (<span class=\"string\">&quot;WebSocket&quot;</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">window</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// alert(&quot;您的浏览器支持 WebSocket!&quot;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">setMessageInnerHTML</span>(<span class=\"string\">&quot;您的浏览器支持 WebSocket!&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 浏览器不支持 WebSocket</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// alert(&quot;您的浏览器不支持 WebSocket!&quot;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">setMessageInnerHTML</span>(<span class=\"string\">&quot;您的浏览器不支持 WebSocket!&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 连接  WebSocket</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">function</span> <span class=\"title function_\">connectWebSocket</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">// 打开一个 web socket</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        websocket = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocket</span>(<span class=\"string\">&quot;ws://localhost:8080/WebSocket_war_exploded/websocket&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        websocket.<span class=\"property\">onopen</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;<span class=\"comment\">// Web Socket 已连接上，使用 send() 方法发送数据</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">setMessageInnerHTML</span>(<span class=\"string\">&quot;WebSocket 已连接...&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        websocket.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span> (<span class=\"params\">evt</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">var</span> received_msg = evt.<span class=\"property\">data</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">setMessageInnerHTML</span>(<span class=\"string\">&quot;收到消息：&quot;</span> + received_msg);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        websocket.<span class=\"property\">onclose</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">setMessageInnerHTML</span>(<span class=\"string\">&quot;WebSocket 已关闭...&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 向WebSocket服务端发送消息</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">function</span> <span class=\"title function_\">sendWebSocket</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">if</span> (websocket) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (websocket.<span class=\"property\">readyState</span> == websocket.<span class=\"property\">OPEN</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">var</span> message = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;txt&#x27;</span>).<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                websocket.<span class=\"title function_\">send</span>(message);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">setMessageInnerHTML</span>(<span class=\"string\">&quot;WebSocket 未连接...&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">setMessageInnerHTML</span>(<span class=\"string\">&quot;WebSocket 未创建...&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">window</span>.<span class=\"property\">onbeforeunload</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"title function_\">closeWebSocket</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 关闭WebSocket连接</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">function</span> <span class=\"title function_\">closeWebSocket</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        websocket.<span class=\"title function_\">close</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 将消息显示在网页上</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">function</span> <span class=\"title function_\">setMessageInnerHTML</span>(<span class=\"params\">innerHTML</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;message&#x27;</span>).<span class=\"property\">innerHTML</span> += innerHTML + <span class=\"string\">&#x27;&lt;br/&gt;&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"WebSocket-服务端-Java-实现\"><a href=\"#WebSocket-服务端-Java-实现\" class=\"headerlink\" title=\"WebSocket 服务端 Java 实现\"></a>WebSocket 服务端 Java 实现</h2><p>由于本人没了解spring框架，对其研究不深，这里用简单的Tomcat的java端实现。</p>\n<ul>\n<li><p>新建一个Maven Web工程，在pom.xml中加入如下websocket依赖：</p>\n<figure class=\"highlight xml\"><figcaption><span>pom.xml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.websocket<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.websocket-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>编辑一个 WebSocket 服务端类：MyWebSocket.java</p>\n<pre><code class=\"java\">package com.test.websocket;\n\nimport java.io.IOException;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n@ServerEndpoint(&quot;/websocket&quot;)\npublic class MyWebSocket &#123;\n\n    private Session session;\n\n    /**\n     * 连接建立后触发的方法\n     */\n    @OnOpen\n    public void onOpen(Session session) &#123;\n        this.session = session;\n        WebSocketMapUtil.put(session.getId(), this);\n        System.out.println(&quot;-------- onOpen: 当前在线人数 &quot; + WebSocketMapUtil.getOnlineCount() + &quot;，连接人 &quot; + session.getId() + &quot; --------&quot;);\n    &#125;\n\n    /**\n     * 连接关闭后触发的方法\n     */\n    @OnClose\n    public void onClose() &#123;\n        // 从map中删除\n        WebSocketMapUtil.remove(session.getId());\n        System.out.println(&quot;-------- onClose: 当前在线人数 &quot; + WebSocketMapUtil.getOnlineCount() + &quot;，关闭人 &quot; + session.getId() + &quot; --------&quot;);\n    &#125;\n\n    /**\n     * 接收到客户端消息时触发的方法\n     */\n    @OnMessage\n    public void onMessage(String message, Session session) throws Exception &#123;\n        // 获取服务端到客户端的通道\n        MyWebSocket myWebSocket = WebSocketMapUtil.get(session.getId());\n        System.out.println(&quot;收到来自 &quot; + session.getId() + &quot; 的消息：&quot; + message);\n\n        // 返回消息给Web Socket客户端（浏览器）\n        myWebSocket.sendMessageAll(&quot;服务端已收到消息：&quot; + message);\n    &#125;\n\n    /**\n     * 发生错误时触发的方法\n     */\n    @OnError\n    public void onError(Session session, Throwable error) &#123;\n        System.out.println(&quot;-------- onError: 当前在线人数 &quot; + WebSocketMapUtil.getOnlineCount() + &quot;，连接发生错误 &quot; + session.getId() + &quot;-&quot; + error.getMessage() + &quot; --------&quot;);\n        // error.printStackTrace();\n    &#125;\n\n    /**\n     * 给单个客户端发送消息\n     *\n     * @param message\n     * @param sessionId\n     * @throws IOException\n     */\n    public void sendMessageSingle(String message, String sessionId) throws IOException &#123;\n\n        // session.getBasicRemote().sendText(message); 同步消息\n        // session.getAsyncRemote().sendText(message); 异步消息\n\n        MyWebSocket myWebSocket = WebSocketMapUtil.get(sessionId);\n        if (myWebSocket != null) &#123;\n            myWebSocket.session.getBasicRemote().sendText(message);\n        &#125;\n    &#125;\n\n    /**\n     * 给所有客户端发送消息\n     *\n     * @param message\n     * @throws IOException\n     */\n    public void sendMessageAll(String message) throws IOException &#123;\n        for (MyWebSocket item : WebSocketMapUtil.getValues()) &#123;\n            item.session.getAsyncRemote().sendText(message);\n            System.out.println(item.session.getId());\n            System.out.println(item.session.isSecure());\n            System.out.println(item.session.isOpen());\n        &#125;\n    &#125;\n\n&#125;\n</code></pre>\n</li>\n<li><p>编辑一个 WebSocket 工具类：WebSocketMapUtil.java</p>\n<p>&#96;&#96;&#96;java WebSocketMapUtil.java<br>package com.test.websocket;</p>\n<p>import java.util.Collection;<br>import java.util.concurrent.ConcurrentHashMap;<br>import java.util.concurrent.ConcurrentMap;</p>\n<p>public class WebSocketMapUtil {<br>public static ConcurrentMap&lt;String, MyWebSocket&gt; webSocketMap &#x3D; new ConcurrentHashMap&lt;&gt;();<br><br>public static void put(String key, MyWebSocket myWebSocket) {<br>    webSocketMap.put(key, myWebSocket);<br>}<br><br>public static MyWebSocket get(String key) {<br>    return webSocketMap.get(key);<br>}<br><br>public static void remove(String key) {<br>    webSocketMap.remove(key);<br>}<br><br>public static Collection<MyWebSocket> getValues() {<br>    return webSocketMap.values();<br>}<br><br>public static int getOnlineCount() {<br>    return webSocketMap.size();<br>}<br>}</p>\n</li>\n</ul>\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><p>项目运行结果：</p>\n<p><img data-src=\"/../../../image/image-20221114095607448.png\" alt=\"image-20221114095607448\"></p>\n<p>测试结果：</p>\n<p><img data-src=\"/../../../image/image-20221114095725205.png\" alt=\"image-20221114095725205\"></p>\n<p>网络连接分析</p>\n<p><img data-src=\"/../../../image/image-20221114100227219.png\" alt=\"image-20221114100227219\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>客户端通过<code>new WebSocket(url)</code>向服务器请求建立websocket连接，服务端收到请求后对其建立全双工信道，并重写一些方法对客户端的操作进行响应，每次客户端则直接通过<code>send()</code>方法发送前端信息给后端，后端进行处理。</p>\n<p>当浏览器关闭时，websocket连接自动断掉。</p>\n<p>以上就是websocket简单应用实例，只是应用的话还是比较基础的。</p>\n",
            "tags": [
                "WebSocket"
            ]
        },
        {
            "id": "http://victinsever.github.io/2022/10/24/%E6%89%A9%E5%B1%95%E6%8A%80%E6%9C%AF/WebSocket/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE%E9%80%89%E5%9E%8B%EF%BC%9AWebSocket/",
            "url": "http://victinsever.github.io/2022/10/24/%E6%89%A9%E5%B1%95%E6%8A%80%E6%9C%AF/WebSocket/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE%E9%80%89%E5%9E%8B%EF%BC%9AWebSocket/",
            "title": "即时通讯协议选型：WebSocket协议",
            "date_published": "2022-10-24T06:38:06.000Z",
            "content_html": "<h4 id=\"WebSocket\"><a href=\"#WebSocket\" class=\"headerlink\" title=\"WebSocket\"></a>WebSocket</h4><p><strong>Socket：</strong>对处于网络中不同主机上的应用进程之间进行双向通信的端点的抽象，是应用程序通过网络协议进行通信的接口，一个Socket对应着通信的一端，由IP地址和端口组合而成。</p>\n<h4 id=\"WebSocket服务端与客户端之间的通信过程\"><a href=\"#WebSocket服务端与客户端之间的通信过程\" class=\"headerlink\" title=\"WebSocket服务端与客户端之间的通信过程\"></a>WebSocket服务端与客户端之间的通信过程</h4><ul>\n<li>服务端创建包含有效主机与端口的WebSocket实例，随后启动并等待客户端连接</li>\n<li>客户端创建WebSocket实例，并为该实例提供一个URL，该URL代表希望连接的服务器端</li>\n<li>客户端通过HTTP请求握手建立连接之后，后面就使用刚才发起HTTP请求的TCP连接进行双向通信。</li>\n</ul>\n<h4 id=\"WebSocket特点\"><a href=\"#WebSocket特点\" class=\"headerlink\" title=\"WebSocket特点\"></a>WebSocket特点</h4><ul>\n<li>WebSocket本身只是一个应用层协议</li>\n<li>一种全双工通信机制</li>\n</ul>\n<h4 id=\"传统的全双工协议的两种方式\"><a href=\"#传统的全双工协议的两种方式\" class=\"headerlink\" title=\"传统的全双工协议的两种方式\"></a>传统的全双工协议的两种方式</h4><ul>\n<li><strong>短轮询</strong> 即客户端定时向服务端发送请求，服务端收到请求后马上返回响应并关闭连接。 <ul>\n<li>优点：实现简单 </li>\n<li>缺点： <ul>\n<li>1.并发请求对服务端造成较大压力 </li>\n<li>2.数据可能没有更新，造成无效请求 </li>\n<li>3.频繁的网络请求导致客户端设备电量、流量快速消耗 </li>\n<li>4.定时操作存在时间差，可能造成数据同步不及时 </li>\n<li>5.每次请求都需要携带完整的请求头</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>长轮询</strong> 即服务端在收到请求之后，如果数据无更新，会阻塞请求，直至数据更新或连接超时才返回。 <ul>\n<li>优点：相较于短轮询减少了HTTP请求的次数，节省了部分资源。 </li>\n<li>缺点： <ul>\n<li>1.连接挂起同样会消耗资源 </li>\n<li>2.冗余请求头问题依旧存在</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"WebSocket比传统全双工协议的优势\"><a href=\"#WebSocket比传统全双工协议的优势\" class=\"headerlink\" title=\"WebSocket比传统全双工协议的优势\"></a>WebSocket比传统全双工协议的优势</h4><p>当连接建立之后，后续的数据都是以<strong>帧的形式</strong>发送。<strong>除非某一端主动断开连接，否则无需重新建立连接</strong>。因此可以做到：</p>\n<ul>\n<li>1.减轻服务器的负担 </li>\n<li>2.极大地减少不必要的流量、电量消耗 </li>\n<li>3.提高实时性，保证客户端和服务端数据的同步 </li>\n<li>4.减少冗余请求头造成的开销</li>\n</ul>\n<h4 id=\"WebSocket比其他即时通讯协议的优势\"><a href=\"#WebSocket比其他即时通讯协议的优势\" class=\"headerlink\" title=\"WebSocket比其他即时通讯协议的优势\"></a>WebSocket比其他即时通讯协议的优势</h4><ul>\n<li><p>1.<strong>较少的控制开销。</strong>在连接创建后，服务器和客户端之间交换数据时，用于协议控制的数据包头部相对较小。 </p>\n</li>\n<li><p>2.<strong>更好的二进制支持。</strong>Websocket定义了二进制帧，相对HTTP，可以更轻松地处理二进制内容。 </p>\n</li>\n<li><p>3.<strong>可以支持扩展。</strong>Websocket定义了扩展，用户可以扩展协议、实现部分自定义的子协议，如XMPP协议、MQTT协议等。</p>\n</li>\n</ul>\n<h4 id=\"WebSocket协议在Android客户端的实现\"><a href=\"#WebSocket协议在Android客户端的实现\" class=\"headerlink\" title=\"WebSocket协议在Android客户端的实现\"></a>WebSocket协议在Android客户端的实现</h4><ul>\n<li>创建WebSocket实例并提供一个URL以指定要连接的服务器地址</li>\n<li>提供一个WebSocket连接事件监听器，用于监听事件回调以处理连接生命周期的每个阶段</li>\n</ul>\n<p>[即时通讯协议选型：WebSocket协议](<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudG91dGlhby5jb20vYXJ0aWNsZS83MTU2MjA5OTM4NTM1MDM5NTI5Lz9vbmx5X3JlYz0xJnNoYXJlX3Rva2VuPTkzNTAyNzUxLTM0ZmEtNDZlZi1iODUxLWUyNzUyZWM0Yjg0OSZzb3VyY2U9bV9yZWRpcmVjdCZ3aWQ9MTY2NjU5Mjc2NzEyNg==\">即时通讯协议选型：WebSocket协议-今日头条 (toutiao.com)</span>)</p>\n",
            "tags": [
                "WebSocket"
            ]
        }
    ]
}